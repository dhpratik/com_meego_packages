<div tal:condition="not: com_meego_packages/packages" i18n:domain="com_meego_packages" i18n:translate="'no_such_package'"></div>

<div class="package" tal:define="packagetitle com_meego_packages/packagetitle; package com_meego_packages/packages/$packagetitle" tal:condition="true: com_meego_packages/packages">

    <div class="screenshot missing" tal:condition="not: package/screenshoturl"></div>

    <div class="screenshot" tal:condition="true: package/screenshoturl">
        <img tal:attributes="src package/screenshoturl" property="v:image" />
    </div>

    <div class="details">

        <h3 class="name"><span>${package/name}</span></h3>

        <!--
        <div class="maintainer">
            <tal:block i18n:domain="com_meego_packages" i18n:translate="'maintainer'"></tal:block>: <span>Maintainer</span>
        </div>
        -->

        <div class="ratcomm">
            <div class="rating">
                <tal:block i18n:domain="com_meego_packages" i18n:translate="'rating'"></tal:block>: <span tal:content="structure package/stars">Stars</span>
            </div>
            <div class="comments" i18n:domain="com_meego_packages" i18n:translate="'comments'">
                <tal:block i18n:name="number">${package/number_of_comments}</tal:block>: <span tal:content="structure package/stars">Stars</span>
            </div>
        </div>
        <div class="description">${package/description}</div>

        <div class="homepage" tal:condition="true: package/homepageurl">
            <a class="url" tal:attributes="href package/homepageurl">Homepage</a>
        </div>

        <div class="latest" tal:condition="true: package/latest">
            <h3 i18n:domain="com_meego_packages" i18n:translate="'title_latest_version'">
                <tal:block i18n:name="version">${package/latest/version}</tal:block>
            </h3>
            <ul tal:condition="true: package/latest/variants">
                <li tal:repeat="variant package/latest/variants">
                    <div class="variant">
                        <a tal:attributes="href variant/packageinstallfileurl; class php: variant.ux . ' ' . variant.repoarch" i18n:domain="com_meego_packages" i18n:attributes="title tip_install" i18n:translate="'command_install'">
                            <tal:block i18n:name="arch">${variant/repoarch}</tal:block>
                        </a>
                    </div>
                </li>
            </ul>

            <div class="warning" tal:condition="true: package/workflows">
                <h3 i18n:domain="com_meego_packages" i18n:translate="'title_app_open_forms'"></h3>
                <div class="workflow_bar">
                    <form tal:repeat="workflow package/workflows" method="post" tal:attributes="action workflow/url">
                        <input type="submit" tal:attributes="value workflow/label" />
                    </form>
                 </div>
            </div>
        </div>

        <div class="ratings">
            <!-- ratings title -->
            <h2 i18n:domain="com_meego_ratings" i18n:translate="'ratings'"/>

            <div class="status" tal:condition="not: com_meego_packages/can_post">
                <!-- notice to login for commenting -->
                <a tal:define="main_url php:midgardmvc.context.get_request(0).get_path(); url string:/mgd:login?redirect=$main_url" tal:attributes="href url" i18n:domain="com_meego_ratings" i18n:translate="'login_to_rate'"/>
            </div>

            <div class="status" tal:condition="not: package/ratings" i18n:domain="com_meego_ratings"  i18n:translate="'first_to_rate'">
                <!-- be the 1st to rate -->
            </div>

            <div class="create-rating" tal:condition="true: com_meego_packages/can_post">
                <mgd:include>cmp-application-comment-form</mgd:include>
            </div>

            <!-- list all ratings and comments -->
            <ul class="list" tal:condition="true: package/ratings">
              <li tal:repeat="rating package/ratings">
                <a class="avatar" tal:condition="true: rating/avatar" tal:attributes="href rating/avatarurl">
                    <img tal:attributes="src rating/avatar" />
                    <span class="firstname" tal:content="rating/authorfirstname">Firstname</span>
                    <span class="lastname" tal:content="rating/authorlastname">Lastname</span>
                </a>
                <tal:block tal:condition="not: rating/avatar">
                    <span class="firstname" tal:content="rating/authorfirstname">Firstname</span>
                    <span class="lastname" tal:content="rating/authorlastname">Lastname</span>
                </tal:block>
                <div class="rating" tal:condition="rating/stars" tal:content="structure rating/stars">First rating</div>
                <div class="comment" tal:condition="rating/commentid" tal:content="rating/comment">Comment</div>
                <div class="date" tal:content="rating/date">Date</div>
              </li>
            </ul>
        </div>

    </div>
</div>
